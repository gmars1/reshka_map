<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Wiki Data Scraper</title>
</head>
<body>
    <h1>Данные «Орел и Решка»</h1>
    <div id="status">Загрузка...</div>
    <pre id="output" style="white-space: pre-wrap; background: #f4f4f4; padding: 10px;"></pre>

    <script>
        async function fetchData() {
            const statusEl = document.getElementById('status');
            const outputEl = document.getElementById('output');
        
            // Используем API напрямую. origin=* — это ключ к успеху для CORS на GitHub Pages
            const apiUrl = "https://cyclowiki.org/w/api.php?" + 
                new URLSearchParams({
                    action: "parse",
                    page: "Выпуски_телепередачи_«Орёл_и_решка»",
                    section: "2",
                    prop: "wikitext", // получаем чистый текст, а не HTML
                    format: "json",
                    origin: "*" // Важнейший параметр для обхода CORS
                });
        
            try {
                const data = await response.json();
        
                if (data.parse && data.parse.wikitext) {
                    const rawText = data.parse.wikitext["*"];
                    
                    // Разделяем текст на строки
                    const lines = rawText.split('\n');
                    const episodes = [];
        
                    lines.forEach(line => {
                        // Ищем строки, начинающиеся с "|", но не заголовочные "|-" или "!"
                        if (line.startsWith('|') && !line.startsWith('|-') && !line.startsWith('!')) {
                            
                            // Разбиваем строку по разделителю ячеек "||"
                            const cells = line.split('||');
                            
                            if (cells.length > 1) {
                                // Вторая ячейка (индекс 1) обычно содержит город
                                const cityCell = cells[1].trim();
                                
                                // Извлекаем название города из [[Вики-ссылки]]
                                // Регулярка ищет текст внутри [[...]]
                                const cityMatch = cityCell.match(/\[\[([^|\]]+)(?:\|[^\]]+)?\]\]/);
                                
                                if (cityMatch) {
                                    episodes.push(cityMatch[1]);
                                }
                            }
                        }
                    });
        
                    // Выводим результат в виде списка
                    statusEl.innerText = `Найдено выпусков: ${episodes.length}`;
                    outputEl.innerHTML = '<ol>' + episodes.map(city => `<li>${city}</li>`).join('') + '</ol>';
                    
                }
        
            } catch (error) {
                statusEl.innerText = "❌ Ошибка: " + error.message;
                statusEl.style.color = "red";
                console.error(error);
            }
        }
        
        fetchData();
    </script>
</body>
</html>




