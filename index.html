<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Wiki Data Scraper</title>
</head>
<body>
    <h1>Данные «Орел и Решка»</h1>
    <div id="status">Загрузка...</div>
    <pre id="output" style="white-space: pre-wrap; background: #f4f4f4; padding: 10px;"></pre>

    <script>
        async function fetchData() {
          const targetUrl = 'https://cyclowiki.org/w/index.php?title=%D0%92%D1%8B%D0%BF%D1%83%D1%81%D0%BA%D0%B8_%D1%82%D0%B5%D0%BB%D0%B5%D0%BF%D0%B5%D1%80%D0%B5%D0%B4%D0%B0%D1%87%D0%B8_%C2%AB%D0%9E%D1%80%D1%91%D0%BB_%D0%B8_%D1%80%D0%B5%D1%88%D0%BA%D0%B0%C2%BB&action=edit&section=2';
          
          // Используем https версию прокси
          const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(targetUrl)}`;
      
          try {
              const response = await fetch(proxyUrl);
              const data = await response.json();
              
              const parser = new DOMParser();
              const doc = parser.parseFromString(data.contents, 'text/html');
              const wikiText = doc.querySelector('#wpTextbox1').value;
      
              // Простой парсинг: ищем строки, начинающиеся с "|" (ячейки таблицы)
              const lines = wikiText.split('\n');
              const listElement = document.getElementById('output');
              listElement.innerHTML = ''; // Очищаем
      
              lines.forEach(line => {
                  // Ищем строки с городами (они обычно в скобках [[Город]])
                  const match = line.match(/\[\[(.*?)\]\]/);
                  if (match) {
                      const li = document.createElement('li');
                      li.textContent = match[1]; // Добавляем название города в список
                      listElement.appendChild(li);
                  }
              });
      
              document.getElementById('status').innerText = 'Список городов из выпусков:';
      
          } catch (error) {
              document.getElementById('status').innerText = 'Ошибка загрузки. Попробуйте обновить страницу.';
              console.error(error);
          }
      }
      
      fetchData();
    </script>
</body>
</html>
